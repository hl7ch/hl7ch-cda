<!--
********************************************************

Schematron Entity for Insurance Providers
Language: en

History:
28.12.2009: Pascal BÃ¼rki, medshare GmbH (Copied from IHE PCC 2008)
31.12.2009: Tony Schaller, medshare GmbH (Abgabe an Auftraggeber)

******************************************************** -->

<!--  IHE PCC v3.0 Comments: 1.3.6.1.4.1.19376.1.5.3.1.4.2 -->

<!-- errors -->

<pattern id="p-1.3.6.1.4.1.19376.1.5.3.1.4.2-errors">
	<title>IHE PCC v3.0 Comments - errors validation phase</title>
	<rule context='*[cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.2"]'>

		<assert role='error' test='cda:templateId[@root="2.16.840.1.113883.10.20.1.40"]'>
			The parent CCD templateId (2.16.840.1.113883.10.20.1.40) for
			Comments must be included.
		</assert>
		<assert role='error' test='cda:code[@code="48767-8" and
			@codeSystem="2.16.840.1.113883.6.1"]'>
			The code element for Comments is required. The code and codeSystem
			attributes shall be recorded exactly as indicated. See:
			http://wiki.ihe.net/index.php?title=1.3.6.1.4.1.19376.1.5.3.1.4.2
		</assert>
		<assert role='error' test='cda:text'>
			In Comment, the &lt;observation&gt; element shall contain a &lt;text&gt;
			element. For
			CDA, the &lt;text&gt; elements shall contain a &lt;reference&gt;
			element pointing
			to the narrative where the severity is recorded, rather than duplicate
			text to avoid ambiguity. For HL7 Version 3 Messages, the &lt;text&gt;
			element
			should contain the full narrative text.
		</assert>
		<assert role='error' test='cda:statusCode[@code = "completed"]'>
			The code attribute of &lt;statusCode&gt; for all Comments
			shall be completed.
		</assert>
		<assert role='error' test='not(cda:author) or (
			cda:author/cda:time and
			cda:author/cda:assignedAuthor/cda:id and
			cda:author/cda:assignedAuthor/cda:addr and
			cda:author/cda:assignedAuthor/cda:telecom and
			cda:author/cda:assignedAuthor/cda:assignedPerson/cda:name and
			cda:author/cda:assignedAuthor/cda:representedOrganization/cda:name)'>
			The Comment may have an author. The time of the comment creation
			shall be recorded in the &lt;time&gt; element when the &lt;author&gt;
			element is present. The identifier of the author, and their address and
			telephone number must be present inside the &lt;id&gt;, &lt;addr&gt; and &lt;telecom&gt;
			elements when the &lt;author&gt; element is present. The author's
			and/or the organization's name must be present when the &lt;author&gt;
			element is present.
		</assert>

	</rule>
</pattern>

<!-- warning -->

<pattern id="p-1.3.6.1.4.1.19376.1.5.3.1.4.2-warnings">
	<title>IHE PCC v3.0 Comments - warning validation phase</title>

	<rule context="*[cda:templateId/@root=&quot;1.3.6.1.4.1.19376.1.5.3.1.4.2&quot;]">
		<assert role='warning' test='cda:text/cda:reference'>
			In Comment, the &lt;observation&gt; element shall contain a
			&lt;text&gt;
			element. For
			CDA, the &lt;text&gt; elements shall contain a &lt;reference&gt;
			element pointing
			to the narrative where the severity is recorded, rather than duplicate
			text to avoid ambiguity. For HL7 Version 3 Messages, the &lt;text&gt;
			element
			should contain the full narrative text.
		</assert>

	</rule>


</pattern>

<!-- manual -->

<pattern id="p-1.3.6.1.4.1.19376.1.5.3.1.4.2-manual">
	<title>IHE PCC v3.0 Comments - manual validation phase</title>

	<!--
	<rule context="*[cda:templateId/@root=&quot;1.3.6.1.4.1.19376.1.5.3.1.4.2&quot;]">
	<report test="."/>
	</rule>
	-->
</pattern>

