<?xml version='1.0' encoding='utf-8'?>
<!--
********************************************************

Schematron rules for HL7 CDA-CH, V1.2 medication sections
Language: de-CH

History:
20.12.2009: Tony Schaller, medshare GmbH (Draft)
31.12.2009: Tony Schaller, medshare GmbH (Abgabe an Auftraggeber)
01.04.2010: Stefan Schenk, medshare GmbH, (XHTML-Dokumentation)
17.05.2010: Tony Schaller, medshare GmbH (Einfügen finaler OIDs)
09.09.2010: Tony Schaller, medshare GmbH (erste Übersetzungen Französisch)

********************************************************
-->
<!--
********************************************************
Medikamentenliste
********************************************************
-->
<pattern>

	<!-- Entity Information -->
	<xhtml:ul id="cda-ch-1.2_medication-section">
		<xhtml:li class="filename">cda-ch-1.2_medication-section.ent</xhtml:li>
		<xhtml:li class="version">1.2</xhtml:li>
	</xhtml:ul>
    
    
	<rule context='*[cda:templateId/@root="2.16.756.5.30.1.1.1.1.1" and cda:templateId/@extension="CDA-CH.Body.MediList"]'>
    	<!-- Rule Documentation -->
		<xhtml:h3 lang="de_ch">CDA-CH Medication Section</xhtml:h3>
		<xhtml:p lang="de_ch">Die nachfolgenden Regeln beschreiben die Prüfungen zu den CDA-CH Medication Section Templates.</xhtml:p>
		<xhtml:h3 lang="fr_ch">CDA-CH Medication Section Templates</xhtml:h3>
		<xhtml:p lang="fr_ch">Les règles suivantes décrivent les contrôles effectués sur les CDA-CH Medication Section Templates</xhtml:p>
		<!--
		<xhtml:h3 lang="it_ch">todo: italiano</xhtml:h3>
		<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
		-->   

 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0001" test="self::cda:section">
			<xhtml:p lang="de_ch">Medikationsdaten müssen als 'section' im CDA Body deklariert werden.</xhtml:p>
			<xhtml:p lang="fr_ch">Les données de médication doivent être déclarées  en tant que « section » dans le CDA Body.</xhtml:p>
			<!--
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0002" test="cda:text">
			<xhtml:p lang="de_ch">Medikationsdaten müssen einen narrativen Text enthalten.</xhtml:p>
			<xhtml:p lang="fr_ch">Les données de médication doivent contenir un texte narratif.</xhtml:p>
			<!--
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0003" test="cda:title">
			<xhtml:p lang="de_ch">Medikationsdaten müssen einen narrativen Titel enthalten.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
	</rule>
    

    <!--
    ********************************************************
    Einzelnes Medikament
    ********************************************************
    -->
	<!--	Template Check -->
	<rule context='cda:substanceAdministration'>
    	<!-- Rule Documentation -->
		<xhtml:h3 lang="de_ch">CDA-CH Medication Section Template Check</xhtml:h3>
		<xhtml:p lang="de_ch">Die nachfolgenden Regeln beschreiben die Prüfungen zu den CDA-CH Medication Section Template Check.</xhtml:p>
		<!--
		<xhtml:h3 lang="fr_ch">todo: francaise</xhtml:h3>
		<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
		<xhtml:h3 lang="it_ch">todo: italiano</xhtml:h3>
		<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
		-->     
    
 		<!--	Template Identifikation 	-->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0101" test='cda:templateId/@root="2.16.756.5.30.1.1.1.1.1" and cda:templateId/@extension="CDA-CH.Body.MediL3"'>
			<xhtml:p lang="de_ch">Medikationseinträge müssen mit der templateId root="2.16.756.5.30.1.1.1.1.1" extension="CDA-CH.Body.MediL3" angegeben werden.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
		
		<!--	Med. Therapie oder Impfung 	-->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0102" test='cda:code/@codeSystem="2.16.840.1.113883.5.4"'>
			<xhtml:p lang="de_ch">Medikationsdaten müssen eine Verordnungsart beinhalten (gültiger Wert aus der Wertetabelle 'ActSubstanceAdministrationCode (2.16.840.1.113883.5.4)').</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0103" test='cda:code/@code=document("../../../../schematrons/HL7.ch/CDA-CH/v1.2/cda-ch-1.2-voc.xml")/systems/system[@root="2.16.840.1.113883.5.4"]/code/@value'>
			<xhtml:p lang="de_ch">Medikationsdaten müssen eine Verordnungsart beinhalten (gültiger Wert aus der Wertetabelle 'ActSubstanceAdministrationCode (2.16.840.1.113883.5.4)').</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
		
		<!--	Identifikation mit GTIN oder Pharmacode 	-->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0104" test='cda:id/@root="2.16.756.5.30.2.6.1" or cda:id/@root="1.3.88"'>
			<xhtml:p lang="de_ch">Medikationseinträge müssen mindestens mit der Packungs-GTIN oder der Identifikation aus SwissIndex identifiziert werden (Strichcode oder Pharmacode).</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
		
		<!-- Klassifizierung erforderlich -->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0105" test='cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code[@codeSystem="2.16.756.5.30.2.6.2" or @codeSystem="2.16.840.1.113883.6.73"]'>
			<xhtml:p lang="de_ch">Medikationsdaten müssen mit dem WHO ATC Code oder mit dem Generic Group Code klassifiziert werden.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0106" test='cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code/@codeSystem!="2.16.756.5.30.2.6.2" or cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code/cda:translation/@codeSystem="2.16.840.1.113883.6.73"'>
			<xhtml:p lang="de_ch">Medikationsdaten, welche mit dem Generic Group Code klassifiziert werden, müssen eine translation nach WHO ATC code enthalten.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
		
		<!-- Dringlichkeitsangaben -->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0107" test='cda:priorityCode/@codeSystem="2.16.840.1.113883.5.7"'>
			<xhtml:p lang="de_ch">Medikationsdaten müssen eine Dringlichkeitsangabe beinhalten (gültiger Wert aus der Wertetabelle 'ActPriority (2.16.840.1.113883.5.7)').</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
 		<assert role='warning' id="entity_HL7-cda-ch-1.2_medication-section-0108" test='cda:priorityCode/@codeSystem="2.16.840.1.113883.5.7" and (cda:priorityCode/@code="R" or cda:priorityCode/@code="UR" or cda:priorityCode/@code="PRN")'>
			<xhtml:p lang="de_ch">Dringlichkeitsangabe entspricht nicht den Empfehlungen im VHitG Arztbrief V1.0</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0109" test='cda:priorityCode/@code=document("../../../../schematrons/HL7.ch/CDA-CH/v1.2/cda-ch-1.2-voc.xml")/systems/system[@root="2.16.840.1.113883.5.7"]/code/@value'>
			<xhtml:p lang="de_ch">Medikationsdaten müssen eine Dringlichkeitsangabe beinhalten (gültiger Wert aus der Wertetabelle 'ActPriority (2.16.840.1.113883.5.7)').</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>

		<!--	Einnahmeart	-->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0110" test='cda:routeCode/@code=document("../../../../schematrons/HL7.ch/CDA-CH/v1.2/cda-ch-1.2-voc.xml")/systems/system[@root="2.16.840.1.113883.5.112"]/code/@value'>
			<xhtml:p lang="de_ch">Medikationsdaten müssen eine Einnahmeart beinhalten (gültiger Wert aus der Wertetabelle 'RouteOfAdministration (2.16.840.1.113883.5.112)').</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>

		<!--	Dosierung	-->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0111" test='cda:doseQuantity'>
			<xhtml:p lang="de_ch">Die Dosierung muss gemäss Addendum zum VHitG Arztbrief, Kapitel 1.2.5 spezifiziert werden.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>

		<!--	Einnahmeplan	-->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0112" test='cda:effectiveTime'>
			<xhtml:p lang="de_ch">Der Einnahmeplan muss gemäss Addendum zum VHitG Arztbrief, Kapitel 1.2.6 spezifiziert werden.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>

 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0113" test='count(cda:doseQuantity/cda:center)=0 or cda:doseQuantity/cda:center/@value!="0"'>
			<xhtml:p lang="de_ch">Die Dosierung darf nicht 0 oder leer sein.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>

	</rule>
    
	<!--	CDA-CH.Body.MediL3 Checks -->
	<rule context='*[cda:templateId/@root="2.16.756.5.30.1.1.1.1.1" and cda:templateId/@extension="CDA-CH.Body.MediL3"]'>
    	<!-- Rule Documentation -->
		<xhtml:h3 lang="de_ch">CDA-CH Medication Section CDA-CH.Body.MediL3 Checks</xhtml:h3>
		<xhtml:p lang="de_ch">Die nachfolgenden Regeln beschreiben die Prüfungen zu den CDA-CH Medication Section CDA-CH.Body.MediL3 Checks.</xhtml:p>
		<!--
		<xhtml:h3 lang="fr_ch">todo: francaise</xhtml:h3>
		<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
		<xhtml:h3 lang="it_ch">todo: italiano</xhtml:h3>
		<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
		-->  
		
		<!--	Korrekte RIM Klasse 	-->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0201" test="self::cda:substanceAdministration">
			<xhtml:p lang="de_ch">Medikationsdaten müssen als 'substanceAdministration' im CDA Body deklariert werden.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>
		
		<!--	Bezeichnung 	-->
 		<assert id="entity_HL7-cda-ch-1.2_medication-section-0202" test="cda:text">
			<xhtml:p lang="de_ch">Medikationsdaten müssen auch im entry einen narrativen Text enthalten (Bezeichnung des Artikels).</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>

		<!--	IHE PCC Templates (für xPHR Extract und xPHR Update) -->
 		<assert role='warning' id="entity_HL7-cda-ch-1.2_medication-section-0203" test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.7"'>
			<xhtml:p lang="de_ch">Medikationsdaten sollten das IHE PCC Template 'Medications' (1.3.6.1.4.1.19376.1.5.3.1.4.7) implementieren.</xhtml:p>
			<!--
			<xhtml:p lang="fr_ch">todo: francaise</xhtml:p>
			<xhtml:p lang="it_ch">todo: italiano</xhtml:p>
			-->
		</assert>

	</rule>
</pattern>

