<!--
********************************************************

Schematron rules for HL7 CDA-CH, V1.2 medication sections

History:
20.12.2009: Tony Schaller, medshare GmbH (Draft)
31.12.2009: Tony Schaller, medshare GmbH (Abgabe an Auftraggeber)
01.04.2010: Stefan Schenk, medshare GmbH, (XHTML-Dokumentation)
17.05.2010: Tony Schaller, medshare GmbH (Einfügen finaler OIDs)
09.09.2010: Tony Schaller, medshare GmbH (erste Übersetzungen Französisch)
11.12.2010: Tony Schaller, medshare GmbH (Version aus dem Dateinamen entfernt. Die Version wird im SVN Repository verwaltet und über den Pfad definiert)
23.01.2011: Tony Schaller, medshare GmbH (Übersetzungen französisch)
07.02.2011: Tony Schaller, medshare GmbH (Korrekturen Übersetzungen französisch)

********************************************************
-->
<!--
********************************************************
Medikamentenliste
********************************************************
-->
<pattern>
	<!-- Entity Information -->
	<xhtml:ul id="cda-ch_medication-section" xmlns:xhtml="http://www.w3.org/1999/xhtml">
		<xhtml:li class="filename">cda-ch_medication-section.ent</xhtml:li>
		<xhtml:li class="version">1.2</xhtml:li>
	</xhtml:ul>
	<rule context="*[cda:templateId/@root=&quot;2.16.756.5.30.1.1.1.1.1&quot; and cda:templateId/@extension=&quot;CDA-CH.Body.MediList&quot;]">
		<!-- Rule Documentation -->
		<xhtml:h3 lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">CDA-CH Medication Section</xhtml:h3>
		<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Die nachfolgenden Regeln beschreiben die Prüfungen zu den CDA-CH Medication Section Templates</xhtml:p>
		<xhtml:h3 lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">CDA-CH Medication Section Templates</xhtml:h3>
		<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les règles suivantes décrivent les contrôles effectués sur les CDA-CH Medication Section Templates</xhtml:p>
		<!--
		<xhtml:h3 lang='it_ch'>totranslate: italiano</xhtml:h3>
		<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
		-->
		<assert id="cda-ch_medication-section-0101" test="self::cda:section">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen als 'section' im CDA Body deklariert werden</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent être déclarées comme 'section' dans le CDA Body</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<assert id="cda-ch_medication-section-0102" test="cda:text">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen einen narrativen Text enthalten</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent contenir un texte narratif</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<assert id="cda-ch_medication-section-0103" test="cda:title">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen einen narrativen Titel enthalten</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent contenir un titre narratif</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
	</rule>
</pattern>
<pattern>
	<!--
	********************************************************
	Einzelnes Medikament
	********************************************************
	-->
	<!--	Template Check -->
	<rule context="cda:substanceAdministration">
		<!-- Rule Documentation -->
		<xhtml:h3 lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">CDA-CH Medication Entry</xhtml:h3>
		<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Die nachfolgenden Regeln beschreiben die Prüfungen zu den CDA-CH Medication Entry Templates</xhtml:p>
		<xhtml:h3 lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">CDA-CH Medication Section Entry</xhtml:h3>
		<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les règles suivantes décrivent les contrôles effectués sur les CDA-CH Medication Entry Templates</xhtml:p>
		<!--
		<xhtml:h3 lang='it_ch'>totranslate: italiano</xhtml:h3>
		<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
		-->
		<!--	Template Identifikation 	-->
		<assert id="cda-ch_medication-section-0201" test="cda:templateId/@root=&quot;2.16.756.5.30.1.1.1.1.1&quot; and cda:templateId/@extension=&quot;CDA-CH.Body.MediL3&quot;">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationseinträge müssen mit der templateId root="2.16.756.5.30.1.1.1.1.1" extension="CDA-CH.Body.MediL3" angegeben werden</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les entrées de médication doivent être saisies avec le templateId root="2.16.756.5.30.1.1.1.1.1" extension="CDA-CH.Body.MediL3"</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!--	Med. Therapie oder Impfung 	-->
		<assert id="cda-ch_medication-section-0202" test="cda:code/@codeSystem=&quot;2.16.840.1.113883.5.4&quot;">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen eine Verordnungsart beinhalten (gültiger Wert aus der Wertetabelle 'ActSubstanceAdministrationCode (2.16.840.1.113883.5.4)')</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent contenir un type de prescription (valeur valable du tableau de valeurs 'ActSubstanceAdministrationCode (2.16.840.1.113883.5.4)')</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<assert id="cda-ch_medication-section-0203" test="cda:code/@code=document(&quot;../../../../schematrons/HL7.ch/CDA-CH/v1.2/cda-ch-voc.xml&quot;)/systems/system[@root=&quot;2.16.840.1.113883.5.4&quot;]/code/@value">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen eine Verordnungsart beinhalten (gültiger Wert aus der Wertetabelle 'ActSubstanceAdministrationCode (2.16.840.1.113883.5.4)')</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent contenir un type de prescription (valeur valable du tableau de valeurs 'ActSubstanceAdministrationCode (2.16.840.1.113883.5.4)')</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!--	Identifikation mit GTIN oder Pharmacode 	-->
		<assert id="cda-ch_medication-section-0204" test="cda:id/@root=&quot;2.16.756.5.30.2.6.1&quot; or cda:id/@root=&quot;1.3.88&quot; or cda:id/@root=&quot;1.3.160&quot;">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationseinträge müssen mindestens mit der Packungs-GTIN oder der Identifikation aus swissINDEX identifiziert werden (Strichcode oder Pharmacode)</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les entrées de médication doivent être identifiées au moins avec le GTIN de l'emballage ou l'identification de swissINDEX (code à barres ou pharmacode)</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!-- Klassifizierung erforderlich -->
		<assert id="cda-ch_medication-section-0205" test="cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code[@codeSystem=&quot;2.16.756.5.30.2.6.2&quot; or @codeSystem=&quot;2.16.840.1.113883.6.73&quot;]">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen mit dem WHO ATC Code oder mit dem Generic Group Code klassifiziert werden</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent être classifiées avec le WHO ATC Code ou avec le Generic Group Code</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<assert id="cda-ch_medication-section-0206" test="cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code/@codeSystem!=&quot;2.16.756.5.30.2.6.2&quot; or cda:consumable/cda:manufacturedProduct/cda:manufacturedMaterial/cda:code/cda:translation/@codeSystem=&quot;2.16.840.1.113883.6.73&quot;">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten, welche mit dem Generic Group Code klassifiziert werden, müssen eine translation nach WHO ATC code enthalten</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication qui sont classifiées avec le Generic Group Code doivent contenir une translation selon le WHO ATC code</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!-- Dringlichkeitsangaben -->
		<assert id="cda-ch_medication-section-0207" test="cda:priorityCode/@codeSystem=&quot;2.16.840.1.113883.5.7&quot;">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen eine Dringlichkeitsangabe beinhalten (gültiger Wert aus der Wertetabelle 'ActPriority (2.16.840.1.113883.5.7)')</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent contenir une indication d'urgence (valeur valable du tableau de valeurs 'ActPriority (2.16.840.1.113883.5.7)')</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<assert role="warning" id="cda-ch_medication-section-0208" test="cda:priorityCode/@codeSystem=&quot;2.16.840.1.113883.5.7&quot; and (cda:priorityCode/@code=&quot;R&quot; or cda:priorityCode/@code=&quot;UR&quot; or cda:priorityCode/@code=&quot;PRN&quot;)">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Dringlichkeitsangabe entspricht nicht den Empfehlungen im VHitG Arztbrief V1.0</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">L'indication d'urgence ne correspond pas aux recommandations dans le rapport médical VHitG V1.0</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<assert id="cda-ch_medication-section-0209" test="cda:priorityCode/@code=document(&quot;../../../../schematrons/HL7.ch/CDA-CH/v1.2/cda-ch-voc.xml&quot;)/systems/system[@root=&quot;2.16.840.1.113883.5.7&quot;]/code/@value">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen eine Dringlichkeitsangabe beinhalten (gültiger Wert aus der Wertetabelle 'ActPriority (2.16.840.1.113883.5.7)')</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent contenir une indication d'urgence (valeur valable du tableau de valeurs 'ActPriority (2.16.840.1.113883.5.7)')</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!--	Einnahmeart	-->
		<assert id="cda-ch_medication-section-0210" test="cda:routeCode/@code=document(&quot;../../../../schematrons/HL7.ch/CDA-CH/v1.2/cda-ch-voc.xml&quot;)/systems/system[@root=&quot;2.16.840.1.113883.5.112&quot;]/code/@value">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen eine Einnahmeart beinhalten (gültiger Wert aus der Wertetabelle 'RouteOfAdministration (2.16.840.1.113883.5.112)')</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent contenir un mode d'administration (valeur valable du tableau de valeurs 'RouteOfAdministration (2.16.840.1.113883.5.112)')</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!--	Dosierung	-->
		<assert id="cda-ch_medication-section-0211" test="cda:doseQuantity">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Die Dosierung muss gemäss Addendum zum VHitG Arztbrief, Kapitel 1.2.5 spezifiziert werden</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Le dosage doit être spécifié selon l'addenda au rapport médical VHitG, chapitre 1.2.5</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!--	Einnahmeplan	-->
		<assert id="cda-ch_medication-section-0212" test="cda:effectiveTime">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Der Einnahmeplan muss gemäss Addendum zum VHitG Arztbrief, Kapitel 1.2.6 spezifiziert werden</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Le plan d'administration doit être spécifié selon l'addenda au rapport médical VHitG, chapitre 1.2.6</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<assert id="cda-ch_medication-section-0213" test="count(cda:doseQuantity/cda:center)=0 or cda:doseQuantity/cda:center/@value!=&quot;0&quot;">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Die Dosierung darf nicht 0 oder leer sein</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Le dosage ne doit pas être 0 ou vide</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
	</rule>
</pattern>
<pattern>
	<!--	CDA-CH.Body.MediL3 Checks -->
	<rule context="*[cda:templateId/@root=&quot;2.16.756.5.30.1.1.1.1.1&quot; and cda:templateId/@extension=&quot;CDA-CH.Body.MediL3&quot;]">
		<!-- Rule Documentation -->
		<xhtml:h3 lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">CDA-CH Medication Entry L3</xhtml:h3>
		<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Die nachfolgenden Regeln beschreiben die Prüfungen zu den CDA-CH Medication Entry Templates</xhtml:p>
		<xhtml:h3 lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">CDA-CH Medication Section Entry L3</xhtml:h3>
		<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les règles suivantes décrivent les contrôles effectués sur les CDA-CH Medication Entry Templates</xhtml:p>
		<!--
		<xhtml:h3 lang='it_ch'>totranslate: italiano</xhtml:h3>
		<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
		-->
		<!--	Korrekte RIM Klasse 	-->
		<assert id="cda-ch_medication-section-0301" test="self::cda:substanceAdministration">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen als 'substanceAdministration' im CDA Body deklariert werden</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent être déclarées comme 'substanceAdministration' dans le CDA Body</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!--	Bezeichnung 	-->
		<assert id="cda-ch_medication-section-0302" test="cda:text">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten müssen auch im entry einen narrativen Text enthalten (Bezeichnung des Artikels)</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent contenir un texte narratif également dans l'entry (désignation de l'article)</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
		<!--	IHE PCC Templates (für xPHR Extract und xPHR Update) -->
		<assert role="warning" id="cda-ch_medication-section-0303" test="cda:templateId/@root=&quot;1.3.6.1.4.1.19376.1.5.3.1.4.7&quot;">
			<xhtml:p lang="de_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Medikationsdaten sollten das IHE PCC Template 'Medications' (1.3.6.1.4.1.19376.1.5.3.1.4.7) implementieren</xhtml:p>
			<xhtml:p lang="fr_ch" xmlns:xhtml="http://www.w3.org/1999/xhtml">Les données de médication doivent implémenter l'IHE PCC Template 'Medications' (1.3.6.1.4.1.19376.1.5.3.1.4.7)</xhtml:p>
			<!--
			<xhtml:p lang='it_ch'>totranslate: italiano</xhtml:p>
			-->
		</assert>
	</rule>
</pattern>
